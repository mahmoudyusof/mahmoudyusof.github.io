{"hash":"5b5f75d25e19532c39ff18cd701a577df7c533a1","data":{"article":{"content":"<h1 id=\"client-side-inference-with-tfjs\"><a href=\"#client-side-inference-with-tfjs\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Client Side Inference with TFJS</h1>\n<p>This article explains everything you need to know in order to start using deeplearning models in the browser.<br>\nIn particular, we are going to talk about running inference in the browswer, since training models in the browser doesn't really make that much sense. God bless Google Colab &#x3C;3</p>\n<h2 id=\"why\"><a href=\"#why\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Why?</h2>\n<p>Traditionally, we used to load a model in server (usually flask servers), send requests with the input features to that server, run inference and send the results in the response. That's fine, but if you have a big web app that handles a lot of different requests, then it makes perfect sense to outsource some of the computations to the front-end, which would improve the performance of your web app.<br>\nThe most time consuming task you might have in your webserver might be the inference task, if you outsource this task to the browser, your server is going to be blazing fast.</p>\n<h2 id=\"how\"><a href=\"#how\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>How?</h2>\n<p>Sold, now tell me how to do it.<br>\nWe all know that the most used language on the browser is JavaScript. If you don't like it, then maybe this article is not for you.<br>\nLet's see the steps that we need to go through to get what we want.  </p>\n<ul>\n<li>Install tensorflowjs-converter.</li>\n<li>Convert a saved model to js compatible format.</li>\n<li>Send the model in a response and save it in the browser.</li>\n<li>Load the model from the browser and run inference.</li>\n</ul>\n<!-- See <a class=\"mdlink\" href=\"https://mahmoudyusof.github.io/general/saving-keras-models/\">this article</a> to know how to save your trained models. -->\n<p>The model I am going to use in here is a generator model, you can find how to create it and save it in <a href=\"https://github.com/mahmoudyusof/hands-on-ml/blob/master/17_Generative_Models/DCGANs.ipynb\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this notebook</a></p>\n<h3 id=\"installing-tensorflowjs-converter\"><a href=\"#installing-tensorflowjs-converter\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Installing tensorflowjs-converter</h3>\n<p>This CLI tool comes by default when you install tensorflowjs via pip.  </p>\n<pre class=\"language-shell\"><code class=\"language-shell\">$ pip <span class=\"token function\">install</span> tensorflowjs</code></pre>\n<p>That's it, now you have the converter installed and you can use the CLI to convert your model to the required format for TFJS.</p>\n<h3 id=\"converting-the-saved-model\"><a href=\"#converting-the-saved-model\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Converting the saved model</h3>\n<p>Before we start with the conversion, you should take a look at the <code>--help</code> option in this command.</p>\n<pre class=\"language-text\"><code class=\"language-text\">$ tensorflowjs_converter --help</code></pre>\n<p>As you can see, there are multiple input formats available, since there are many ways by which you can save a model.<br>\nIn my case I used keras to create the model and saved it in a <code>SavedModel</code> format which creates a directory with a <code>saved_model.pb</code> file in it.  </p>\n<p>Now we want to convert this model.</p>\n<pre class=\"language-text\"><code class=\"language-text\">$ tensorflow_converter --input_format=tf_saved_model source/model/directory target/save/directory</code></pre>\n<p>In this command <code>source/model/directory</code> should have a file with the <code>pb</code> extension. This will output a <code>model.json</code> file and some other binary fiels in the target directory.</p>\n<h3 id=\"save-the-model-in-the-browser\"><a href=\"#save-the-model-in-the-browser\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Save the model in the browser</h3>\n<p>Now for some JS stuff. First install tensorflowjs in your app. You can use npm or just include the CDN link in your code directly.</p>\n<ul>\n<li>CDN <code>&#x3C;script src=\"https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js\">&#x3C;/script></code></li>\n<li>npm installation <code>$ npm install --save @tensorflow/tfjs</code></li>\n<li>yarn installation <code>$ yarn add @tensorflow/tfjs</code></li>\n</ul>\n<p>Now let's create a funciton that responds to, for example, a click event. This function will do the following:</p>\n<ul>\n<li>\n<p>Try to load the model from localStorage</p>\n<ul>\n<li>If it fails it will load the model from the server</li>\n<li>Then save the model in localStorage</li>\n</ul>\n</li>\n<li>Run inference with the model</li>\n<li>Update UI to display results</li>\n</ul>\n<blockquote>\n<p>In the following code we will be using a GAN model to generate hand written digits. If you don't know how GANs work, basically we need a random vector and we'll pass it to the model and the model will return a 28 by 28 image. In this particular GAN we also give it a label specifying which digit we want to generate.</p>\n</blockquote>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// load the model from localstorage</span>\ntf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">fromGraphModel</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localstorage://saved_model_name\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">model</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// success case, run the generate function.</span>\n        <span class=\"token function\">generate</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// if you fail, load the model from the server</span>\n        tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">fromGraphModel</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://model-server-url/model_directory\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">model</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// In the chained \"then call\" save the model in localstorage</span>\n            model<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">save</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localstorage://saved_model_name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            \n            <span class=\"token comment\">// run inference</span>\n            <span class=\"token function\">generate</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"some unexpected error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Now let's take a look at the generate method and see what it does. This is where most of the tfjs stuff takes place.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// import the library under the tf namespace</span>\n<span class=\"token keyword module\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword module\">as</span> tf <span class=\"token keyword module\">from</span> <span class=\"token string\">\"@tensorflow/tfjs\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">generate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">model</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// tf.tidy handles garbage collection to prevent any memory leakage</span>\n    tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">tidy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// vector of shape [batch_size, encoding_dim]</span>\n        <span class=\"token keyword\">const</span> random_vector <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">randomNormal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// the label tensor, shape is [batch_size, 1]</span>\n        <span class=\"token comment\">// I am passing the data type as int32 because I want the funciton to return an int,</span>\n        <span class=\"token comment\">// however the model accepts float numbers not ints this is why I am casting the tensor.</span>\n        <span class=\"token keyword\">const</span> label <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">randomUniform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"int32\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cast</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"float32\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// generate new image</span>\n        model<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>random_vector<span class=\"token punctuation\">,</span> label<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">image</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// let's dispose of the model since we don't need it in memory any more</span>\n            model<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// images are of shape [batch_size, 28, 28]</span>\n            <span class=\"token comment\">// batch_size here is 1 so we can remove it by squeezing the tensor</span>\n            image <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">squeeze</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// the output of the model ranges from -1 to 1, let's make it from 0 to 1 since the next funciton is picky</span>\n            image <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">div</span><span class=\"token punctuation\">(</span>tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">scalar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">scalar</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\">// let's now make the image of rank 3 to make it an appropriate image of shape [28, 28, 1] which means a gray scale image</span>\n            <span class=\"token comment\">// The second argument of this function is the axis of expansion</span>\n            image <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">expandDims</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Let's now resize the image from [28, 28, 1] to [200, 200, 1].</span>\n            image <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span><span class=\"token property-access\">image</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resizeNearestNeighbor</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Now let's get the canvas element, that we should create in markup, and write this image to it.</span>\n            <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myCanvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            \n            tf<span class=\"token punctuation\">.</span><span class=\"token property-access\">browser</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toPixels</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">output</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Success\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token doc-comment comment\">/**\n             * Horrai!! you did it,\n             * you just created a function that runs a GAN on the browser!\n            */</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            model<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<blockquote>\n<p>To know more check out <a href=\"https://js.tensorflow.org/api/latest/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">TFJS documentation</a></p>\n</blockquote>\n<h2 id=\"demo\"><a href=\"#demo\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Demo</h2>\n<p>If you want to test the final product see <a href=\"https://mahmoudyusof.github.io/projects/digit-image-generator\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this demo</a>.</p>\n<h1 id=\"that-is-it-congratulations\"><a href=\"#that-is-it-congratulations\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>That is it, CONGRATULATIONS.</h1>\n<p>Now you can use client side inference. I should tell you that this is not recommended for resource demanding models, since they might crash the frontend because they require a lot of memory, so extract light weight models only to the client side.  </p>\n<p>If you have any comments, questions or recommendations please reach out to me at any time, I hope this was helpful.</p>\n<h1 id=\"full-code\"><a href=\"#full-code\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Full Code</h1>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// import the library under the tf namespace</span>\n<span class=\"token keyword module\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword module\">as</span> tf <span class=\"token keyword module\">from</span> <span class=\"token string\">\"@tensorflow/tfjs\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">generate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">model</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// tf.tidy handles garbage collection to prevent any memory leakage</span>\n    tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">tidy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// vector of shape [batch_size, encoding_dim]</span>\n        <span class=\"token keyword\">const</span> random_vector <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">randomNormal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// the label tensor, shape is [batch_size, 1]</span>\n        <span class=\"token comment\">// I am passing the data type as int32 because I want the funciton to return an int,</span>\n        <span class=\"token comment\">// however the model accepts float numbers not ints this is why I am casting the tensor.</span>\n        <span class=\"token keyword\">const</span> label <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">randomUniform</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"int32\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">cast</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"float32\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// generate new image</span>\n        model<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>random_vector<span class=\"token punctuation\">,</span> label<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">image</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// images are of shape [batch_size, 28, 28]</span>\n            <span class=\"token comment\">// batch_size here is 1 so we can remove it by squeezing the tensor</span>\n            image <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">squeeze</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// the output of the model ranges from -1 to 1, let's make it from 0 to 1 since the next funciton is picky</span>\n            image <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">div</span><span class=\"token punctuation\">(</span>tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">add</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">scalar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">scalar</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\">// let's now make the image of rank 3 to make it an appropriate image of shape [28, 28, 1] which means a gray scale image</span>\n            <span class=\"token comment\">// The second argument of this function is the axis of expansion</span>\n            image <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">expandDims</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Let's now resize the image from [28, 28, 1] to [200, 200, 1].</span>\n            image <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span><span class=\"token property-access\">image</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resizeNearestNeighbor</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Now let's get the canvas element, that we should create in markup, and write this image to it.</span>\n            <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"myCanvas\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            \n            tf<span class=\"token punctuation\">.</span><span class=\"token property-access\">browser</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">toPixels</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">output</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Success\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token doc-comment comment\">/**\n             * Horrai!! you did it,\n             * you just created a function that runs a GAN on the browser!\n            */</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// load the model from localstorage</span>\ntf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">fromGraphModel</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localstorage://saved_model_name\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">model</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// success case, run the generate function.</span>\n        <span class=\"token function\">generate</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// if you fail, load the model from the server</span>\n        tf<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">fromGraphModel</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://model-server-url/model_directory\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">model</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// In the chained \"then call\" save the model in localstorage</span>\n            model<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">save</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localstorage://saved_model_name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            \n            <span class=\"token comment\">// run inference</span>\n            <span class=\"token function\">generate</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"some unexpected error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n","id":"4d7c960b2979bde427b43daeeb54673e","title":"Client Side Inference with TFJS","type":"article","description":"How to convert models to JavaScript compatible format, save them on the clients' browsers and load them for inference.","image":"https://mahmoudyusof.github.io/seo_images/client-side-inference-meme.jpg","url":"https://mahmoudyusof.github.io/cgan/client-side-inference/"}},"context":{}}